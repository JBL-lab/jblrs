<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>야구팀 기록 관리 (LocalStorage)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root { color-scheme: light dark; }
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">
  <header class="sticky top-0 z-20 bg-white/80 backdrop-blur border-b">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
      <h1 class="text-xl font-bold">⚾️ 야구팀 기록 관리 (LocalStorage)</h1>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-6 space-y-8">
    <!-- 팀 추가 -->
    <section class="bg-white rounded-2xl shadow p-4">
      <h2 class="text-lg font-semibold mb-4">팀 추가</h2>
      <div class="flex flex-col md:flex-row gap-3 items-stretch md:items-end">
        <label class="flex-1">
          <span class="block text-sm text-gray-600 mb-1">팀 이름</span>
          <input id="teamName" class="w-full rounded-xl border px-3 py-2" placeholder="예) Seoul Sluggers" />
        </label>
        <button id="addTeamBtn" class="rounded-xl px-4 py-2 bg-blue-600 text-white">팀 추가</button>
      </div>

      <div class="mt-4">
        <label class="block text-sm text-gray-600 mb-1">등록된 팀</label>
        <select id="teamSelect" class="w-full md:w-80 rounded-xl border px-3 py-2"></select>
      </div>
    </section>

    <!-- 선수 추가 -->
    <section class="bg-white rounded-2xl shadow p-4">
      <h2 class="text-lg font-semibold mb-4">선수 추가</h2>
      <div class="grid md:grid-cols-3 gap-3 items-end">
        <label>
          <span class="block text-sm text-gray-600 mb-1">팀 선택</span>
          <select id="playerTeamSelect" class="w-full rounded-xl border px-3 py-2"></select>
        </label>
        <label>
          <span class="block text-sm text-gray-600 mb-1">선수 이름</span>
          <input id="playerName" class="w-full rounded-xl border px-3 py-2" placeholder="예) Kim Minho" />
        </label>
        <button id="addPlayerBtn" class="rounded-xl px-4 py-2 bg-blue-600 text-white">선수 추가</button>
      </div>
    </section>

    <!-- 기록 입력 -->
    <section class="bg-white rounded-2xl shadow p-4">
      <h2 class="text-lg font-semibold mb-4">기록 입력</h2>
      <div class="grid md:grid-cols-4 gap-3 items-end">
        <label>
          <span class="block text-sm text-gray-600 mb-1">팀</span>
          <select id="recordTeamSelect" class="w-full rounded-xl border px-3 py-2"></select>
        </label>
        <label>
          <span class="block text-sm text-gray-600 mb-1">선수</span>
          <select id="recordPlayerSelect" class="w-full rounded-xl border px-3 py-2"></select>
        </label>
      </div>

      <div class="grid md:grid-cols-5 gap-3 mt-4">
        <label>
          <span class="block text-xs text-gray-600 mb-1">홈런</span>
          <input id="hr" type="number" min="0" value="0" class="w-full rounded-xl border px-3 py-2 text-right" />
        </label>
        <label>
          <span class="block text-xs text-gray-600 mb-1">안타</span>
          <input id="hits" type="number" min="0" value="0" class="w-full rounded-xl border px-3 py-2 text-right" />
        </label>
        <label>
          <span class="block text-xs text-gray-600 mb-1">총 투구 수</span>
          <input id="pitches" type="number" min="0" value="0" class="w-full rounded-xl border px-3 py-2 text-right" />
        </label>
        <label>
          <span class="block text-xs text-gray-600 mb-1">스트라이크</span>
          <input id="strikes" type="number" min="0" value="0" class="w-full rounded-xl border px-3 py-2 text-right" />
        </label>
        <label>
          <span class="block text-xs text-gray-600 mb-1">세이브</span>
          <input id="saves" type="number" min="0" value="0" class="w-full rounded-xl border px-3 py-2 text-right" />
        </label>
      </div>

      <div class="mt-4 flex gap-3">
        <button id="saveRecordBtn" class="rounded-xl px-4 py-2 bg-emerald-600 text-white">기록 저장</button>
        <span id="saveStatus" class="text-sm text-gray-600"></span>
      </div>
    </section>

    <!-- 기록 현황 -->
    <section class="bg-white rounded-2xl shadow p-4">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold">기록 현황</h2>
        <label class="flex items-center gap-2 text-sm">
          <span class="text-gray-600">팀 필터</span>
          <select id="boardTeamFilter" class="rounded-xl border px-3 py-2"></select>
        </label>
      </div>

      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
              <th class="text-left px-3 py-2">선수</th>
              <th class="text-right px-3 py-2">홈런</th>
              <th class="text-right px-3 py-2">안타</th>
              <th class="text-right px-3 py-2">투구 수</th>
              <th class="text-right px-3 py-2">스트라이크</th>
              <th class="text-right px-3 py-2">세이브</th>
              <th class="text-right px-3 py-2">관리</th>
            </tr>
          </thead>
          <tbody id="boardBody" class="divide-y"></tbody>
        </table>
      </div>
    </section>

    <!-- 선수 프로필 -->
    <section id="playerProfile" class="hidden bg-white rounded-2xl shadow p-4">
      <h2 class="text-lg font-semibold mb-4">선수 프로필</h2>
      <div id="profileContent" class="space-y-3"></div>
      <div>
        <label class="block text-sm text-gray-600 mb-1">메모</label>
        <textarea id="profileMemo" class="w-full rounded-xl border p-2" rows="4" placeholder="메모를 입력하세요..."></textarea>
      </div>
      <div class="mt-3 flex gap-2">
        <button id="saveMemoBtn" class="rounded-xl px-4 py-2 bg-blue-600 text-white">메모 저장</button>
        <button id="closeProfileBtn" class="rounded-xl px-4 py-2 bg-gray-300">닫기</button>
      </div>
    </section>
  </main>

  <footer class="max-w-5xl mx-auto px-4 py-10 text-center text-xs text-gray-500">
    LocalStorage에 저장됩니다.
  </footer>

  <script>
    let teams = JSON.parse(localStorage.getItem('teams') || '[]');
    let players = JSON.parse(localStorage.getItem('players') || '[]');

    const teamNameInput = document.getElementById('teamName');
    const addTeamBtn = document.getElementById('addTeamBtn');
    const teamSelect = document.getElementById('teamSelect');
    const playerTeamSelect = document.getElementById('playerTeamSelect');
    const playerNameInput = document.getElementById('playerName');
    const addPlayerBtn = document.getElementById('addPlayerBtn');
    const recordTeamSelect = document.getElementById('recordTeamSelect');
    const recordPlayerSelect = document.getElementById('recordPlayerSelect');
    const hrInput = document.getElementById('hr');
    const hitsInput = document.getElementById('hits');
    const pitchesInput = document.getElementById('pitches');
    const strikesInput = document.getElementById('strikes');
    const savesInput = document.getElementById('saves');
    const saveRecordBtn = document.getElementById('saveRecordBtn');
    const boardTeamFilter = document.getElementById('boardTeamFilter');
    const boardBody = document.getElementById('boardBody');

    const playerProfile = document.getElementById('playerProfile');
    const profileContent = document.getElementById('profileContent');
    const profileMemo = document.getElementById('profileMemo');
    const saveMemoBtn = document.getElementById('saveMemoBtn');
    const closeProfileBtn = document.getElementById('closeProfileBtn');

    let currentProfileId = null;
    let lastSelectedTeamId = playerTeamSelect.value;

    function saveData() {
      localStorage.setItem('teams', JSON.stringify(teams));
      localStorage.setItem('players', JSON.stringify(players));
      renderTeams();
      renderBoard();

      // 선수 추가 시 마지막 선택된 팀 유지
      if (lastSelectedTeamId) {
        playerTeamSelect.value = lastSelectedTeamId;
      }
    }

    function renderTeams() {
      [teamSelect, playerTeamSelect, recordTeamSelect, boardTeamFilter].forEach(sel => {
        sel.innerHTML = '<option value="">— 팀 선택 —</option>';
        teams.forEach(t => {
          const o = document.createElement('option');
          o.value = t.id;
          o.textContent = t.name;
          sel.appendChild(o);
        });
      });
    }

    function renderPlayers(teamId, select) {
      select.innerHTML = '<option value="">— 선수 선택 —</option>';
      players.filter(p => p.teamId === teamId).forEach(p => {
        const o = document.createElement('option');
        o.value = p.id;
        o.textContent = p.name;
        select.appendChild(o);
      });
    }

    function renderBoard() {
      boardBody.innerHTML = '';
      const filterTeam = boardTeamFilter.value;
      players.filter(p => !filterTeam || p.teamId === filterTeam).forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-3 py-2"><button class="text-blue-600 underline profileBtn" data-id="${p.id}">${p.name}</button> <span class="text-xs text-gray-500">(${teamName(p.teamId)})</span></td>
          <td class="px-3 py-2 text-right">${p.hr||0}</td>
          <td class="px-3 py-2 text-right">${p.hits||0}</td>
          <td class="px-3 py-2 text-right">${p.pitches||0}</td>
          <td class="px-3 py-2 text-right">${p.strikes||0}</td>
          <td class="px-3 py-2 text-right">${p.saves||0}</td>
          <td class="px-3 py-2 text-right"><button class="deleteBtn text-red-600" data-id="${p.id}">삭제</button></td>
        `;
        boardBody.appendChild(tr);
      });

      document.querySelectorAll('.deleteBtn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          players = players.filter(p => p.id !== id);
          saveData();
        });
      });

      document.querySelectorAll('.profileBtn').forEach(btn => {
        btn.addEventListener('click', () => showProfile(btn.dataset.id));
      });
    }

    function teamName(id) {
      const t = teams.find(t => t.id === id);
      return t ? t.name : '-';
    }

    addTeamBtn.addEventListener('click', () => {
      const name = teamNameInput.value.trim();
      if (!name) return;
      teams.push({ id: Date.now().toString(), name });
      teamNameInput.value = '';
      saveData();
    });

    addPlayerBtn.addEventListener('click', () => {
      const teamId = playerTeamSelect.value;
      const name = playerNameInput.value.trim();
      if (!teamId || !name) return;
      players.push({ id: Date.now().toString(), teamId, name, hr:0,hits:0,pitches:0,strikes:0,saves:0, memo:'' });
      playerNameInput.value = '';
      lastSelectedTeamId = teamId; // 마지막 선택된 팀 저장
      saveData();
    });

    recordTeamSelect.addEventListener('change', () => {
      renderPlayers(recordTeamSelect.value, recordPlayerSelect);
    });

    saveRecordBtn.addEventListener('click', () => {
      const playerId = recordPlayerSelect.value;
      if (!playerId) return;
      const p = players.find(x => x.id === playerId);
      p.hr += parseInt(hrInput.value)||0;
      p.hits += parseInt(hitsInput.value)||0;
      p.pitches += parseInt(pitchesInput.value)||0;
      p.strikes += parseInt(strikesInput.value)||0;
      p.saves += parseInt(savesInput.value)||0;
      saveData();
      [hrInput,hitsInput,pitchesInput,strikesInput,savesInput].forEach(i => i.value=0);
    });

    boardTeamFilter.addEventListener('change', renderBoard);

    function showProfile(id) {
      const p = players.find(x => x.id === id);
      if (!p) return;
      currentProfileId = id;
      profileContent.innerHTML = `
        <p><b>이름:</b> ${p.name}</p>
        <p><b>팀:</b> ${teamName(p.teamId)}</p>
        <p><b>홈런:</b> ${p.hr}</p>
        <p><b>안타:</b> ${p.hits}</p>
        <p><b>투구 수:</b> ${p.pitches}</p>
        <p><b>스트라이크:</b> ${p.strikes}</p>
        <p><b>세이브:</b> ${p.saves}</p>
      `;
      profileMemo.value = p.memo || '';
      playerProfile.classList.remove('hidden');
    }

    saveMemoBtn.addEventListener('click', () => {
      if (!currentProfileId) return;
      const p = players.find(x => x.id === currentProfileId);
      if (p) {
        p.memo = profileMemo.value;
        saveData();
      }
    });

    closeProfileBtn.addEventListener('click', () => {
      playerProfile.classList.add('hidden');
      currentProfileId = null;
    });

    renderTeams();
    renderBoard();
  </script>
</body>
</html>
